function browse(){$.each(subjects,function(e,s){var t=$("#subj-list-template").clone().removeClass("hide").removeAttr("id").addClass("subj-"+e);t.find(".panel-title").text(s+" ("+e+")"),$("#subj-list").append(t)})}function loadCourses(e,s,t,a){var n=s.substring(s.indexOf("</span>"+t.FOS+" "+a)),i=n.substring(0,n.indexOf("\x3c!--close inner-content-wrap")),r=i.substring(t.FOS.length+9+t["Course Number"].length,i.indexOf("</a>")),o=i.substring(i.indexOf("Description</div>")+17);o=o.substring(0,o.indexOf("</div>"));var u=i.substring(i.indexOf("Units: ")+7,i.indexOf("</div>")),l=!0;r.indexOf("Print Courses")>-1&&(l=!1,r=t.Title,o="Course has no description",u="units are unknown");var c="";i.indexOf("Prerequisites</div>")>-1&&(c=(c=i.substring(i.indexOf("Prerequisites</div>")+19)).substring(0,c.indexOf("</div>"))),t.Title.indexOf("ST:")>-1||t.Title.indexOf("SP:")>-1||"FYS"===t.FOS||"WELL"===t.FOS||"HIST"===t.FOS&&"199"===t["Course Number"]||"HIST"===t.FOS&&"299"===t["Course Number"]||"ENGL"===t.FOS&&"299"===t["Course Number"]||"BIOL"===t.FOS&&"199"===t["Course Number"]||l&&(t.Title=r),"FYS"===t.FOS&&"description"in t?(r=t.displayTitle,o=t.description):"description"in t||(r=t.Title);var d="<h4>"+r+"</h4><p>"+o+"</p><p>Units: "+u+"</p>";""!==c&&(d=d+"<p>Prerequisites: "+c+"</p>"),e.find("#title").text(t.FOS+" "+t["Course Number"]+" | "+r),e.find(".panel-body").html(d),e.find("#button").attr("data-fos",t.FOS).attr("data-coursenum",t["Course Number"]).attr("data-coursename",t.Title).attr("data-displayTitle",t.displayTitle);var m=!1;return $.each(t.crns,function(e,s){crns.indexOf(s)>-1&&(m=!0)}),t.Available?m&&e.find("#button").removeClass("btn-success").removeClass("btn-add-course").removeClass("glyphicon-plus").addClass("btn-disable").text("Preregistered"):e.find("#button").removeClass("btn-success").removeClass("btn-add-course").removeClass("glyphicon-plus").addClass("btn-disable").text("Course Not Available"),$("#course-basket, #course-basket-required").find("li").each(function(){$(this).data("fos")===t.FOS&&$(this).data("coursenum")===parseInt(t["Course Number"])&&$(this).data("coursename")===t.Title&&e.find("#button").removeClass("glyphicon-plus").removeClass("btn-success").removeClass("btn-add-course").addClass("btn-danger").addClass("glyphicon-minus").addClass("btn-remove-course")}),e}function fetchBySubj(e){$.ajax({url:"richmondAPI.php",jsonp:"callback",dataType:"jsonp",data:{subj:e},success:function(s){s=s.response,$.getJSON("richmondAPI.php?catalog-subj="+e+"&callback=?",function(t){t=t.courses,$.each(s,function(s,a){var n=$("#subj-list-template2").clone().removeAttr("id"),i=a["Course Number"];i<=99&&(i="0"+i),n=loadCourses(n,t,a,i).removeClass("hide"),$("#subj-list").find(".subj-"+e).find(".main-body").append(n)})})}})}function addCourse(e,s,t,a){function n(){$(this).data("fos")===e&&$(this).data("coursenum")===s&&$(this).data("coursename")===t&&($(this).removeClass("glyphicon-plus"),$(this).removeClass("btn-success"),$(this).removeClass("btn-add-course"),$(this).addClass("btn-danger"),$(this).addClass("glyphicon-minus"),$(this).addClass("btn-remove-course"))}var i=!0;if($("#course-basket li, #course-basket-required li").each(function(){$(this).data("fos")===e&&$(this).data("coursenum")===s&&$(this).data("coursename")===t&&(i=!1)}),i){$("#search-results button").each(n),$(".panel .panel-default button").each(n);var r=$addedTemplate.clone(),o=$buttonRemoveTemplate.clone().removeClass("hide");r.removeClass("hide").attr("id","").text(e+" "+s+" | "+t).append("&nbsp; &nbsp; &nbsp; &nbsp;",o).attr("data-fos",e).attr("data-coursenum",s).attr("data-coursename",t).attr("data-displayTitle",a),$("#course-basket").append(r)}}var crns="";void 0!==$("#crns").val()&&$("#crns").val().length>0&&(crns=$("#crns").val().replace(/[,]+/g,"").replace(/ +(?= )/g,"").split(" "));var subjects={ACCT:"Accounting",AMST:"American Studies",ANTH:"Anthropology",ARAB:"Arabic",ARTH:"Art History",BIOL:"Biology",BMB:"Biochemistry",BUAD:"Business Administration",CHEM:"Chemistry",CHIN:"Chinese Program",CJ:"Criminal Justice",CLAC:"Cultures and Languages Across the Curriculum",CLCV:"Classical Studies",CLSC:"Classical Studies",CMSC:"Computer Science",DANC:"Dance",ECON:"Economics",EDUC:"Education",ENGL:"English",ENVR:"Environmental Studies",FIN:"Finance",FMST:"Film Studies",FREN:"French Program",FYS:"First Year Seminar",GEOG:"Geography",GERM:"German Studies Program",GREK:"Greek",HCS:"Healthcare Studies",HIST:"History",IBUS:"International Business",IDST:"Interdisciplinary Studies",IS:"International Studies",ITAL:"Italian Studies Program",JAPN:"Japanese Program",JOUR:"Journalism",JWST:"Jewish Studies",LAIS:"Latin American, Latino and Iberian Studies",LATN:"Latin",LDST:"Leadership Studies",LLC:"Languages, Literatures and Cultures",MATH:"Mathematics",MGMT:"Management",MKT:"Marketing",MSAP:"Music-Applied",MSCL:"Military Science and Leadership",MSEN:"Music-Ensemble",MUS:"Music",PHIL:"Philosophy",PHYS:"Physics",PLSC:"Political Science",PPEL:"Philosophy Politics Economics and Law",PSYC:"Psychology",RELG:"Religious Studies",RHCS:"Rhetoric and Communication Studies",RUSN:"Russian Studies Program",SDLC:"Languages, Literatures and Cultures",SOC:"Sociology",SPCS:"School of Professional and Continuing Studies",SWAH:"Languages, Literatures and Cultures",THTR:"Theatre",UNIV:"University Seminar",VMAP:"Visual and Media Arts Practice",WELL:"Wellness Program",WGSS:"Women, Gender and Sexuality Studies"};browse();var alreadyFetched=[];$(document).on("click",".collapse-btn",function(){var e=$(this).parent().attr("class").split(" ");e=e[e.length-1].split("-")[1],-1===alreadyFetched.indexOf(e)&&(fetchBySubj(e),alreadyFetched.push(e)),$(this).parent().find(".panel-collapse:not(.subj-list-collapse)").collapse("toggle")}),$(document).on("click",".collapse-btn-subj",function(){$(this).parent().parent().find(".panel-collapse").collapse("toggle")}),$(function(){$("#time-pref").bootstrapToggle({on:"Morning",off:"Afternoon",offstyle:"warning"}),$("#full-classes").bootstrapToggle({on:"Yes",off:"No",offstyle:"danger",onstyle:"success"})});var $defaultSearchResult=$("#searchResultTemplate"),$addedTemplate=$("#addedTemplate"),$buttonRemoveTemplate=$("#basket-remove");$(document).on("keyup","#searchField",function(){var e=$("#searchField").val();""===e&&$("#search-results").empty(),e.length<3||$.ajax({url:"richmondAPI.php",jsonp:"callback",dataType:"jsonp",data:{search:e},success:function(e){e=e.response,$.each(e,function(e,s){var t=$defaultSearchResult.clone(),a=s["Course Number"],n=a;a<=99&&(a="0"+a),a>99&&(n=n.substr(0,1)+"00"),$.getJSON("richmondAPI.php?catalog-subj="+s.FOS+"&catalog-level="+n+"&callback=?",function(n){n=n.courses,t=loadCourses(t,n,s,a).removeAttr("id").removeClass("hide"),0===e&&$("#search-results").empty(),$("#search-results").append(t)})})}})}),$(document).on("click",".btn-generate",function(){function e(e){return{CourseNum:$(e).data("coursenum"),FOS:$(e).data("fos"),Title:$(e).data("coursename"),displayTitle:$(e).data("displaytitle"),requiredCourse:!1}}var s=[],t=$("#course-basket li"),a=t.size();s=s.concat(t.toArray().map(e)),a+=(t=$("#course-basket-required li")).size(),s=s.concat(t.toArray().map(e).map(function(e){return e.requiredCourse=!0,e}));var n=$("#block .blocked-time").toArray().map(function(e){return $(e).find("input, .time-display").toArray().reduce(function(e,s){if(void 0!==$(s).text()&&""!==$(s).text()){var t=$(s).text().split(" - ");e.startTime=t[0],e.endTime=t[1]}return $(s).is(":checked")&&(e[$(s).attr("name")]=$(s).attr("name")),e},{})}),i=$("#crns").val().replace(/\D+/g,",").split(",");s={allCourses:s,timePref:$("#time-pref").prop("checked"),fullClasses:$("#full-classes").prop("checked"),preregistered:i,startTime:$("#restrict-slider").text().split(" - ")[0],endTime:$("#restrict-slider").text().split(" - ")[1],unwantedTimes:n},a>5&&window.alert("Trying to generate schedules with this many courses may take a long time, but I will try.\n\nThe calculation is allowed take up to 5 minutes, if it takes longer, it will fail."),window.location.assign("makeSchedule.php?i="+encodeURIComponent(JSON.stringify(s)))}),$(document).on("click",".btn-jumbo-close",function(){$(this).parent().parent().hide(),document.cookie="jumbotron=hidden"}),$(document).on("click",".btn-remove-course",function(e){function s(){$(this).data("fos")===a&&$(this).data("coursenum")===n&&$(this).data("coursename")===i&&$(this).addClass("glyphicon-plus").addClass("btn-success").addClass("btn-add-course").removeClass("btn-danger").removeClass("glyphicon-minus").removeClass("btn-remove-course")}var t=$(e.target);void 0===t.data("fos")&&(t=t.parent());var a=t.data("fos"),n=t.data("coursenum"),i=t.data("coursename");$("#search-results").find("button").each(s),$(".panel .panel-default button").each(s),$("#course-basket li, #course-basket-required li").each(function(){$(this).data("fos")===a&&$(this).data("coursenum")===n&&$(this).data("coursename")===i&&$(this).remove()})}),$(document).on("click",".btn-add-course",function(e){var s=$(e.target);addCourse(s.data("fos"),s.data("coursenum"),s.data("coursename"),s.data("displaytitle"))});
