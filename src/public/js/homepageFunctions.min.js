var crns="";"undefined"!=typeof $("#crns").val()&&0<$("#crns").val().length&&(crns=$("#crns").val().replace(/[,]+/g,"").replace(/ +(?= )/g,"").split(" "));var subjects={ACCT:"Accounting",AMST:"American Studies",ANTH:"Anthropology",ARAB:"Arabic",ARTH:"Art History",BIOL:"Biology",BMB:"Biochemistry",BUAD:"Business Administration",CHEM:"Chemistry",CHIN:"Chinese Program",CJ:"Criminal Justice",CLAC:"Cultures and Languages Across the Curriculum",CLCV:"Classical Studies",CLSC:"Classical Studies",CMSC:"Computer Science",DANC:"Dance",ECON:"Economics",EDUC:"Education",ENGL:"English",ENVR:"Environmental Studies",FIN:"Finance",FMST:"Film Studies",FREN:"French Program",FYS:"First Year Seminar",GEOG:"Geography",GERM:"German Studies Program",GREK:"Greek",HCS:"Healthcare Studies",HIST:"History",IBUS:"International Business",IDST:"Interdisciplinary Studies",IS:"International Studies",ITAL:"Italian Studies Program",JAPN:"Japanese Program",JOUR:"Journalism",JWST:"Jewish Studies",LAIS:"Latin American, Latino and Iberian Studies",LATN:"Latin",LDST:"Leadership Studies",LLC:"Languages, Literatures and Cultures",MATH:"Mathematics",MGMT:"Management",MKT:"Marketing",MSAP:"Music-Applied",MSCL:"Military Science and Leadership",MSEN:"Music-Ensemble",MUS:"Music",PHIL:"Philosophy",PHYS:"Physics",PLSC:"Political Science",PPEL:"Philosophy Politics Economics and Law",PSYC:"Psychology",RELG:"Religious Studies",RHCS:"Rhetoric and Communication Studies",RUSN:"Russian Studies Program",SDLC:"Languages, Literatures and Cultures",SOC:"Sociology",SPCS:"School of Professional and Continuing Studies",SWAH:"Languages, Literatures and Cultures",THTR:"Theatre",UNIV:"University Seminar",VMAP:"Visual and Media Arts Practice",WELL:"Wellness Program",WGSS:"Women, Gender and Sexuality Studies"};function browse(){$.each(subjects,function(a,b){var c=$("#subj-list-template").clone().removeClass("hide").removeAttr("id").addClass("subj-"+a);c.find(".panel-title").text(b+" ("+a+")"),$("#subj-list").append(c)})}function loadCourses(a,b,c,d){var f=b.substring(b.indexOf("</span>"+c.FOS+" "+d)),g=f.substring(0,f.indexOf("<!--close inner-content-wrap")),h=g.substring(c.FOS.length+9+c["Course Number"].length,g.indexOf("</a>")),j=g.substring(g.indexOf("Description</div>")+17);j=j.substring(0,j.indexOf("</div>"));var l=g.substring(g.indexOf("Units: ")+7,g.indexOf("</div>")),m=!0;-1<h.indexOf("Print Courses")&&(m=!1,h=c.Title,j="Course has no description",l="units are unknown");var n="";-1<g.indexOf("Prerequisites</div>")&&(n=g.substring(g.indexOf("Prerequisites</div>")+19),n=n.substring(0,n.indexOf("</div>"))),-1<c.Title.indexOf("ST:")||-1<c.Title.indexOf("SP:")||"FYS"===c.FOS||"WELL"===c.FOS||"HIST"===c.FOS&&"199"===c["Course Number"]||"HIST"===c.FOS&&"299"===c["Course Number"]||"ENGL"===c.FOS&&"299"===c["Course Number"]||"BIOL"===c.FOS&&"199"===c["Course Number"]||!m||(c.Title=h),"FYS"===c.FOS&&"description"in c?(h=c.displayTitle,j=c.description):!("description"in c)&&(h=c.Title);var o="<h4>"+h+"</h4><p>"+j+"</p><p>Units: "+l+"</p>";""!=n&&(o=o+"<p>Prerequisites: "+n+"</p>"),a.find("#title").text(c.FOS+" "+c["Course Number"]+" | "+h),a.find(".panel-body").html(o),a.find("#button").attr("data-fos",c.FOS),a.find("#button").attr("data-coursenum",c["Course Number"]),a.find("#button").attr("data-coursename",c.Title),a.find("#button").attr("data-displayTitle",c.displayTitle);var p=!1;$.each(c.crns,function(r,s){-1<crns.indexOf(s)&&(p=!0)}),c.Available?p&&(a.find("#button").removeClass("btn-success"),a.find("#button").removeClass("btn-add-course"),a.find("#button").removeClass("glyphicon-plus"),a.find("#button").addClass("btn-disable"),a.find("#button").text("Preregistered")):(a.find("#button").removeClass("btn-success"),a.find("#button").removeClass("btn-add-course"),a.find("#button").removeClass("glyphicon-plus"),a.find("#button").addClass("btn-disable"),a.find("#button").text("Course Not Available"));var q=$("#course-basket, #course-basket-required").find("li");return q.each(function(){$(this).data("fos")===c.FOS&&$(this).data("coursenum")===parseInt(c["Course Number"])&&$(this).data("coursename")===c.Title&&(a.find("#button").removeClass("glyphicon-plus"),a.find("#button").removeClass("btn-success"),a.find("#button").removeClass("btn-add-course"),a.find("#button").addClass("btn-danger"),a.find("#button").addClass("glyphicon-minus"),a.find("#button").addClass("btn-remove-course"))}),a}function fetchBySubj(a){$.ajax({url:"richmondAPI.php",jsonp:"callback",dataType:"jsonp",data:{subj:a},success:function(b){b=b.response,$.getJSON("richmondAPI.php?catalog-subj="+a+"&callback=?",function(c){c=c.courses,$.each(b,function(d,f){var g=$("#subj-list-template2").clone().removeAttr("id"),h=f["Course Number"];99>=f["Course Number"]&&(h="0"+f["Course Number"]),g=loadCourses(g,c,f,h).removeClass("hide"),$("#subj-list").find(".subj-"+a).find(".main-body").append(g)})})}})}browse();var alreadyFetched=[];$(document).on("click",".collapse-btn",function(){var a=$(this).parent().attr("class").split(" ");a=a[a.length-1].split("-")[1],-1===alreadyFetched.indexOf(a)&&(fetchBySubj(a),alreadyFetched.push(a)),$(this).parent().find(".panel-collapse:not(.subj-list-collapse)").collapse("toggle")}),$(document).on("click",".collapse-btn-subj",function(){$(this).parent().parent().find(".panel-collapse").collapse("toggle")}),$(function(){$("#time-pref").bootstrapToggle({on:"Morning",off:"Afternoon",offstyle:"warning"}),$("#full-classes").bootstrapToggle({on:"Yes",off:"No",offstyle:"danger",onstyle:"success"})});var $defaultSearchResult=$("#searchResultTemplate"),$addedTemplate=$("#addedTemplate"),$buttonRemoveTemplate=$("#basket-remove");$(document).on("keyup","#searchField",function(){var a=$("#searchField").val();""===a&&$("#search-results").empty();3>a.length||$.ajax({url:"richmondAPI.php",jsonp:"callback",dataType:"jsonp",data:{search:a},success:function(b){b=b.response,$.each(b,function(c,d){var f=$defaultSearchResult.clone(),g,h=d["Course Number"];99>=h&&(h="0"+d["Course Number"]),g=99<h?d["Course Number"].substr(0,1)+"00":d["Course Number"],$.getJSON("richmondAPI.php?catalog-subj="+d.FOS+"&catalog-level="+g+"&callback=?",function(j){j=j.courses,f=loadCourses(f,j,d,h).removeAttr("id").removeClass("hide"),0===c&&$("#search-results").empty(),$("#search-results").append(f)})})}})}),$(document).on("click",".btn-generate",function(){var a=$("#course-basket").find("li"),b=[],c=0;a.each(function(){var h={CourseNum:$(this).data("coursenum"),FOS:$(this).data("fos"),Title:$(this).data("coursename"),displayTitle:$(this).data("displaytitle")};b.push(h),c++}),a=$("#course-basket-required").find("li"),a.each(function(){var h={CourseNum:$(this).data("coursenum"),FOS:$(this).data("fos"),Title:$(this).data("coursename"),displayTitle:$(this).data("displaytitle"),requiredCourse:!0};b.push(h),c++});var d=[];$("#block").find(".blocked-time").each(function(){var h={};$(this).find("input, .time-display").each(function(){if(""!==$(this).text()&&"undefined"!=typeof $(this).text()){var j=$(this).text().split(" - ");h.startTime=j[0],h.endTime=j[1]}$(this).is(":checked")&&(h[$(this).attr("name")]=$(this).attr("name"))}),d.push(h)});var f=$("#crns").val().replace(/\D+/g,",").split(",");b={allCourses:b,timePref:$("#time-pref").prop("checked"),fullClasses:$("#full-classes").prop("checked"),preregistered:f,startTime:$("#restrict-slider").text().split(" - ")[0],endTime:$("#restrict-slider").text().split(" - ")[1],unwantedTimes:d};var g=JSON.stringify(b);5<c&&window.alert("Trying to generate schedules with this many courses may take a long time, but I will try.\n\nThe calculation is allowed take up to 5 minutes, if it takes longer, it will fail."),window.location.assign("makeSchedule.php?i="+encodeURIComponent(g))}),$(document).on("click",".btn-jumbo-close",function(){$(this).parent().parent().hide(),document.cookie="jumbotron=hidden"}),$(document).on("click",".btn-remove-course",function(a){var b=$(a.target);"undefined"==typeof b.data("fos")&&(b=b.parent());var c=b.data("fos"),d=b.data("coursenum"),f=b.data("coursename");$("#search-results").find("button").each(function(){$(this).data("fos")===c&&$(this).data("coursenum")===d&&$(this).data("coursename")===f&&($(this).addClass("glyphicon-plus"),$(this).addClass("btn-success"),$(this).addClass("btn-add-course"),$(this).removeClass("btn-danger"),$(this).removeClass("glyphicon-minus"),$(this).removeClass("btn-remove-course"))}),$(".panel .panel-default button").each(function(){$(this).data("fos")===c&&$(this).data("coursenum")===d&&$(this).data("coursename")===f&&($(this).addClass("glyphicon-plus"),$(this).addClass("btn-success"),$(this).addClass("btn-add-course"),$(this).removeClass("btn-danger"),$(this).removeClass("glyphicon-minus"),$(this).removeClass("btn-remove-course"))});var g=$("#course-basket").find("li").add("#course-basket-required li");g.each(function(){$(this).data("fos")===c&&$(this).data("coursenum")===d&&$(this).data("coursename")===f&&$(this).remove()})});function addCourse(a,b,c,d){var f=!0,g=$("#course-basket, #course-basket-required").find("li");if(g.each(function(){$(this).data("fos")===a&&$(this).data("coursenum")===b&&$(this).data("coursename")===c&&(f=!1)}),f){$("#search-results").find("button").each(function(){$(this).data("fos")===a&&$(this).data("coursenum")===b&&$(this).data("coursename")===c&&($(this).removeClass("glyphicon-plus"),$(this).removeClass("btn-success"),$(this).removeClass("btn-add-course"),$(this).addClass("btn-danger"),$(this).addClass("glyphicon-minus"),$(this).addClass("btn-remove-course"))}),$(".panel .panel-default button").each(function(){$(this).data("fos")===a&&$(this).data("coursenum")===b&&$(this).data("coursename")===c&&($(this).removeClass("glyphicon-plus"),$(this).removeClass("btn-success"),$(this).removeClass("btn-add-course"),$(this).addClass("btn-danger"),$(this).addClass("glyphicon-minus"),$(this).addClass("btn-remove-course"))});var h=$addedTemplate.clone(),j=$buttonRemoveTemplate.clone().removeClass("hide");h.removeClass("hide"),h.attr("id",""),h.text(a+" "+b+" | "+c),h.append("&nbsp; &nbsp; &nbsp; &nbsp;",j),h.attr("data-fos",a),h.attr("data-coursenum",b),h.attr("data-coursename",c),h.attr("data-displayTitle",d),$("#course-basket").append(h)}}$(document).on("click",".btn-add-course",function(a){var b=$(a.target),c=b.data("fos"),d=b.data("coursenum"),f=b.data("coursename"),g=b.data("displaytitle");addCourse(c,d,f,g)});
